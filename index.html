<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Osun State Weather Forecast</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Roboto', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-image: url('https://images.unsplash.com/photo-1502657877623-f66bf489d236?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80'),
                        url('https://images.unsplash.com/photo-1444259705809-cfed33639efa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-color: rgba(34, 139, 34, 0.4);
      background-blend-mode: overlay, overlay;
      color: #fff;
      min-height: 100vh;
      padding: 10px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    header {
      text-align: center;
      padding: 30px 20px;
      background-color: rgba(255, 255, 255, 0.15);
      border-radius: 15px;
      margin-bottom: 30px;
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    h1 {
      margin: 0;
      font-size: 2.6em;
      color: white;
      text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
      font-weight: 700;
    }
    .user-panel {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: rgba(255, 255, 255, 0.95);
      font-size: 16px;
      margin-top: 10px;
      font-weight: 500;
    }
    .user-panel button {
      background-color: #4285F4;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: background 0.3s;
    }
    .user-panel button:hover {
      background-color: #3367D6;
    }
    .alert-banner {
      background-color: #e74c3c;
      color: white;
      padding: 12px;
      margin: 20px 0;
      border-radius: 10px;
      font-weight: 600;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      display: none;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }
    .location-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 14px;
      margin-bottom: 30px;
      padding: 0 10px;
    }
    .location-button {
      padding: 14px 20px;
      background-color: rgba(9, 132, 227, 0.95);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: all 0.3s ease;
      min-width: 110px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }
    .forecast-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 25px;
      padding: 10px;
    }
    .forecast-card {
      width: calc(20% - 25px);
      min-width: 170px;
      background-color: rgba(255, 255, 255, 0.96);
      border-radius: 15px;
      padding: 20px 16px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
      text-align: center;
      transition: all 0.4s ease;
      border: 1px solid rgba(255, 255, 255, 0.5);
    }
    .forecast-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.18);
    }
    .forecast-card h3 {
      margin: 0 0 14px;
      font-size: 1.25em;
      color: #2d3436;
      font-weight: 700;
    }
    .forecast-card img {
      width: 65px;
      height: 65px;
      margin: 10px auto;
    }
    .forecast-card p {
      margin: 6px 0;
      font-size: 1.05em;
      color: #666;
    }
    .advice {
      font-size: 13px;
      color: #27ae60;
      margin-top: 10px;
      font-style: italic;
      line-height: 1.4;
    }
    @media (max-width: 1024px) {
      .forecast-card { width: calc(25% - 20px); }
      h1 { font-size: 2.3em; }
    }
    @media (max-width: 768px) {
      h1 { font-size: 2.1em; }
      .location-button { padding: 12px 16px; font-size: 14px; }
      .forecast-card { width: calc(33.33% - 18px); }
    }
    @media (max-width: 576px) {
      h1 { font-size: 1.9em; }
      .user-panel { flex-direction: column; gap: 10px; }
      .location-button { padding: 10px 14px; font-size: 13px; min-width: 90px; }
      .forecast-card { width: calc(50% - 15px); }
      .current-weather p { font-size: 1.25em; }
    }
    @media (max-width: 380px) {
      .forecast-card { width: 100%; }
    }

    #agricultural-advice {
  background-color: rgba(255, 255, 224, 0.9); /* Light yellow background */
  border-left: 5px solid #f39c12;
}
#agricultural-advice h2 {
  color: #8e44ad;
}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üå¶Ô∏è Osun State Weather Forecast</h1>
      <div class="user-panel">
        <span id="user-greeting">Signed in as guest@osun.gov.ng</span>
        <button id="login-btn">Sign in with Google</button>
      </div>
    </header>

    <!-- Real-Time Alert Banner -->
    <div id="alert-banner" class="alert-banner"></div>

    <!-- Location Buttons -->
    <div class="location-buttons">
      <button class="location-button" data-city="Osogbo, NG">Osogbo</button>
      <button class="location-button" data-city="Ilesa, NG">Ilesa</button>
      <button class="location-button" data-city="Ede, NG">Ede</button>
      <button class="location-button" data-city="Iwo, NG">Iwo</button>
      <button class="location-button" data-city="Ikire, NG">Ikire</button>
      <button class="location-button" data-city="Ejigbo, NG">Ejigbo</button>
      <button class="location-button" data-city="Ipetumodu, NG">Ipetumodu</button>
      <button class="location-button" data-city="Ifon, NG">Ifon Osun</button>
      <button class="location-button" data-city="Ikirun, NG">Ikirun</button>
      <button class="location-button" data-city="Ila Orangun, NG">Ila Orangun</button>
      <button class="location-button" data-city="Modakeke, NG">Modakeke</button>
      <button class="location-button" data-city="Otan Ayegbaju, NG">Otan Ayegbaju</button>
      <button class="location-button" data-city="Olorunda, NG">Olorunda</button>
      <button class="location-button" data-city="Irepodun, NG">Irepodun</button>
      <button class="location-button" data-city="Ifelodun, NG">Ifelodun</button>
    </div>

    <!-- Current Weather -->
    <div id="current-weather" class="current-weather" style="display: none;">
      <h2 id="current-location"></h2>
      <p id="current-temp"></p>
      <p id="current-condition"></p>
    </div>

    <!-- Agricultural Advisory -->
<div id="agricultural-advice" class="current-weather" style="display: none;">
  <h2>üåæ Agricultural Advisory</h2>
  <p id="farming-advice" style="font-size: 1.2em; line-height: 1.6;">
    <!-- Advice will appear here -->
  </p>
</div>

    <!-- Forecast -->
    <div id="forecast-container" class="forecast-container"></div>

    <!-- Loading / Error -->
    <div id="loading" class="loading">üîç Select a location to view forecast</div>
    <div id="error" class="error" style="display: none;"></div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <script>
  // =============== MODULE 1: CONFIG ===============
  const Config = {
    firebaseConfig: {
      apiKey: "AIzaSyAJWrAfH5mfK2t-ThXDNRAwZOCtNeEK21c",
      authDomain: "osunweatherapp.firebaseapp.com",
      projectId: "osunweatherapp",
      storageBucket: "osunweatherapp.firebasestorage.app",
      messagingSenderId: "906426010667",
      appId: "1:906426010667:web:ef86f9fc95590876306e6e"
    },
    OPEN_WEATHER_API_KEY: 'b13f8883dbd05a97429a758a544c429b'
  };

  // =============== MODULE 2: AUTH ===============
  const AuthModule = {
    auth: null,
    init() {
      firebase.initializeApp(Config.firebaseConfig);
      this.auth = firebase.auth();
      this.bindEvents();
      this.listen();
    },
    bindEvents() {
      document.getElementById('login-btn').addEventListener('click', () => this.toggleSignIn());
    },
    toggleSignIn() {
      const user = this.auth.currentUser;
      if (user) {
        this.auth.signOut();
      } else {
        const provider = new firebase.auth.GoogleAuthProvider();
        this.auth.signInWithPopup(provider).catch(e => AlertModule.show(`Login failed: ${e.message}`, 'info'));
      }
    },
    listen() {
      this.auth.onAuthStateChanged((user) => {
        const btn = document.getElementById('login-btn');
        const greeting = document.getElementById('user-greeting');
        if (user) {
          greeting.textContent = `Signed in as ${user.email}`;
          btn.textContent = 'Sign out';
          AlertModule.enable();
        } else {
          greeting.textContent = 'Signed in to receive alerts';
          btn.textContent = 'Sign in with Google';
          AlertModule.disable();
        }
      });
    }
  };

  // =============== MODULE 3: ALERTS ===============
  const AlertModule = {
    enabled: false,
    requestPermission() {
      if ("Notification" in window && Notification.permission !== "granted") {
        Notification.requestPermission();
      }
    },
    show(message, type = 'warning') {
      const banner = document.getElementById('alert-banner');
      banner.textContent = `üîî ${message}`;
      banner.style.backgroundColor = type === 'error' ? '#e74c3c' : '#3498db';
      banner.style.display = 'block';
      setTimeout(() => banner.style.display = 'none', 6000);

      if (this.enabled && Notification.permission === "granted") {
        new Notification("OsunWeather Alert", { body: message });
      }
    },
    enable() {
      this.enabled = true;
      this.requestPermission();
    },
    disable() {
      this.enabled = false;
    }
  };

  // =============== MODULE 4: WEATHER + AIR QUALITY ===============
  const WeatherModule = {
    async fetchWeather(city) {
      UI.hideAll();
      UI.showLoading();

      try {
        // Step 1: Get coordinates
        const geoRes = await fetch(
          `https://api.openweathermap.org/geo/1.0/direct?q=${city}&limit=1&appid=${Config.OPEN_WEATHER_API_KEY}`
        );
        const geoData = await geoRes.json();
        if (!geoData.length) throw new Error("City not found");

        const { lat, lon, name } = geoData[0];

        // Step 2: Get current + 5-day forecast (free)
        const forecastRes = await fetch(
          `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=metric&appid=${Config.OPEN_WEATHER_API_KEY}`
        );
        if (!forecastRes.ok) throw new Error("Weather data unavailable");
        const forecastData = await forecastRes.json();

        // Step 3: Get Air Quality (FREE API)
        const airRes = await fetch(
          `https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${Config.OPEN_WEATHER_API_KEY}`
        );
        const airData = await airRes.json();

        // Step 4: Display current weather
        const current = forecastData.list[0];
        document.getElementById('current-location').textContent = `üìç ${name}, Osun State`;
        document.getElementById('current-temp').textContent = `${Math.round(current.main.temp)}¬∞C`;
        document.getElementById('current-condition').textContent = 
          `${current.weather[0].description.charAt(0).toUpperCase() + current.weather[0].description.slice(1)}`;
        document.getElementById('current-weather').style.display = 'block';

        // Step 5: Display Air Quality
        this.displayAirQuality(airData.list[0], name);

        // Step 6: Display 5-day forecast
        this.displayForecast(forecastData.list);

        // Step 7: Check for severe weather alerts
        this.checkForAlerts(current, name);

        UI.hideLoading();
      } catch (err) {
        UI.showError(`‚ùå ${err.message}`);
      }
    },

    displayAirQuality(data, city) {
      const aqi = data.main.aqi;
      const pollutants = data.components;

      // AQI to health advice
      const aqiInfo = {
        1: { label: "Good", color: "#00e400", advice: "Air quality is excellent. Safe for all activities." },
        2: { label: "Fair", color: "#00e400", advice: "Air quality is acceptable. Enjoy outdoor work." },
        3: { label: "Moderate", color: "#ffff00", advice: "Sensitive groups should reduce prolonged outdoor exertion." },
        4: { label: "Poor", color: "#ff7e00", advice: "Everyone may experience health effects. Limit outdoor exposure." },
        5: { label: "Very Poor", color: "#ff0000", advice: "Avoid outdoor activities. Risk of respiratory issues." }
      };

      const info = aqiInfo[aqi] || aqiInfo[5];

      // Inject AQI into current weather (below temp)
      let aqiEl = document.getElementById('aqi-display');
      if (!aqiEl) {
        aqiEl = document.createElement('div');
        aqiEl.id = 'aqi-display';
        aqiEl.style.margin = '15px 0';
        aqiEl.style.padding = '12px';
        aqiEl.style.backgroundColor = info.color;
        aqiEl.style.color = 'white';
        aqiEl.style.borderRadius = '8px';
        aqiEl.style.fontSize = '1.1em';
        aqiEl.style.fontWeight = '500';

        const conditionEl = document.getElementById('current-condition');
        conditionEl.insertAdjacentElement('afterend', aqiEl);
      }

      aqiEl.style.backgroundColor = info.color;
      aqiEl.innerHTML = `
        üå´Ô∏è <strong>AQI: ${aqi}</strong> (${info.label})<br>
        <small>${info.advice}</small>
      `;

      // Show alert if poor air quality
      if (AlertModule.enabled && aqi >= 4) {
        AlertModule.show(`Poor air quality in ${city}! AQI: ${aqi}. ${info.advice}`, 'warning');
      }
    },

    displayForecast(list) {
      const container = document.getElementById('forecast-container');
      container.innerHTML = '';

      const daily = {};
      list.forEach(item => {
        const date = new Date(item.dt * 1000).toLocaleDateString();
        if (!daily[date] && Object.keys(daily).length < 5) {
          daily[date] = item;
        }
      });

      Object.values(daily).forEach(day => {
        const date = new Date(day.dt * 1000).toLocaleDateString('en-GB', { day: '2-digit', month: 'short' });
        const temp = Math.round(day.main.temp);
        const desc = day.weather[0].description;
        const icon = day.weather[0].icon;
        const advice = this.getAdvice(day.weather[0].main, temp);

        const card = document.createElement('div');
        card.className = 'forecast-card';
        card.innerHTML = `
          <h3>${date}</h3>
          <img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="${desc}" />
          <p>${temp}¬∞C</p>
          <p>${desc}</p>
          <p class="advice">${advice}</p>
        `;
        container.appendChild(card);
      });
    },

    getAdvice(condition, temp) {
      if (temp > 35) return 'üî• Avoid midday farming. Stay hydrated.';
      if (temp < 20) return '‚ùÑÔ∏è Protect seedlings from cold.';
      if (condition === 'Rain') return 'üåßÔ∏è Delay planting. Risk of flooding.';
      if (condition === 'Thunderstorm') return '‚ö° Stay indoors. Avoid travel.';
      if (condition === 'Clear') return '‚òÄÔ∏è Great day for harvesting!';
      return 'üåæ Monitor conditions for best farming window.';
    },

    checkForAlerts(current, city) {
      const { temp, weather } = current;
      const condition = weather[0].main;

      if (AlertModule.enabled) {
        if (condition === 'Rain' || condition === 'Thunderstorm') {
          AlertModule.show(`${condition} in ${city}! Avoid outdoor work.`, 'warning');
        } else if (temp > 35) {
          AlertModule.show(`Heat alert: ${temp}¬∞C in ${city}! Stay hydrated.`, 'warning');
        }
      }
    }
  };

  // =============== MODULE 5: UI ===============
  const UI = {
    showLoading() {
      document.getElementById('loading').style.display = 'block';
    },
    hideLoading() {
      document.getElementById('loading').style.display = 'none';
    },
    showError(msg) {
      const el = document.getElementById('error');
      el.textContent = msg;
      el.style.display = 'block';
    },
    hideAll() {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('error').style.display = 'none';
    }
  };

  // =============== INIT ===============
  document.addEventListener('DOMContentLoaded', () => {
    AuthModule.init();

    document.querySelectorAll('.location-button').forEach(btn => {
      btn.addEventListener('click', () => {
        const city = btn.getAttribute('data-city');
        WeatherModule.fetchWeather(city);
      });
    });

    if ("Notification" in window) {
      Notification.requestPermission();
    }
  });
</script>

  <!-- Professional Footer -->
  <footer style="background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); color: #fff; padding: 40px 20px; margin-top: 50px; border-top: 1px solid rgba(255, 255, 255, 0.1); font-family: 'Roboto', sans-serif;">
    <div style="max-width: 1200px; margin: 0 auto; display: flex; flex-wrap: wrap; justify-content: space-between; gap: 30px; text-align: center;">
      <div style="flex: 1; min-width: 250px;">
        <h3 style="font-size: 1.6em; margin-bottom: 12px; color: #00d2ff; font-weight: 600;">OsunWeather</h3>
        <p style="color: #ccc; line-height: 1.6; font-size: 0.95em;">
          Reliable, real-time weather forecasting for all 30 LGAs major cities in Osun State.<br>
          Empowering farmers, travelers, and communities with smart weather insights.
        </p>
      </div>
      <div style="flex: 1; min-width: 250px;">
        <h4 style="font-size: 1.3em; margin-bottom: 12px; color: #00d2ff;">Developed By</h4>
        <p style="color: #fff; font-weight: 500; font-size: 1.1em;">WebTech24hr</p>
        <p style="color: #ccc; font-size: 0.95em; margin-top: 8px;">
          Full-Stack Web Developer & Data Scientist<br>
          Specializing in weather & health data integration, and civic tech solutions
        </p>
        <div style="margin-top: 12px;">
          <a href="mailto:webtech24hr@gmail.com" style="color: #00d2ff; text-decoration: none; font-size: 0.95em;">üìß webtech24hr@gmail.com</a>
        </div>
      </div>
      <div style="flex: 1; min-width: 250px;">
        <h4 style="font-size: 1.3em; margin-bottom: 12px; color: #00d2ff;">Powered By</h4>
        <div style="display: flex; justify-content: center; gap: 15px; margin-top: 10px;">
          Osun Sustainable Agribusiness Development<br>(OSAD-FSAA)
        </div>
        <p style="color: #ccc; font-size: 0.9em; margin-top: 15px;">
          Data sourced from OpenWeather<br>
          Auth & Hosting powered by Google Firebase
        </p>
      </div>
    </div>
    <div style="text-align: center; padding-top: 20px; margin-top: 30px; border-top: 1px solid rgba(255, 255, 255, 0.1); color: #aaa; font-size: 0.9em; font-weight: 500;">
      &copy; <span id="year">2025</span> OsunWeather App | Osun Sustainable Agribusiness DevelopmentS(OSAD-FSAA)

    </div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>